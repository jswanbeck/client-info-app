<div class="layout">
  <div>
    <button class="btn-primary" (click)="onOpenModal('create')">New Client</button>
  </div>

  <div>
    <div class="filter-panel">
      <div class="filter-fields">
        <label>
          Field:
          <select
            [(ngModel)]="filterField"
            class="field-select"
            [class.select-invalid]="filterField === ''"
          >
            <option value="" disabled selected hidden>Select a field &#9660;</option>
            <option *ngFor="let key of filterableKeys" [value]="key">{{ key }}</option>
          </select>
        </label>
        <label>
          Value:
          <input
            type="text"
            placeholder="Filter value"
            [(ngModel)]="filterValue"
            (keydown.enter)="addFilter()"
          />
        </label>
      </div>
      <div class="filter-buttons">
        <button class="btn-primary" (click)="addFilter()" [disabled]="!filterButtonEnabled">
          Add Filter
        </button>
        <button class="btn-secondary" (click)="clearFilters()" [disabled]="!clearButtonEnabled">
          Clear
        </button>
      </div>
    </div>

    <div *ngIf="activeFilters.length > 0" class="active-filters">
      <span
        *ngFor="let filter of activeFilters; let i = index"
        class="filter-chip"
        (click)="removeFilter(i)"
      >
        {{ filter.key }}: {{ filter.value }}
      </span>
    </div>
  </div>

  <div class="client-list-pane">
    <div class="client-list-card">
      <div class="search-input-container">
        <input
          class="search-input"
          type="search"
          placeholder="Search clients..."
          [(ngModel)]="searchTerm"
        />
      </div>
      <app-client-list
        [clients]="filteredClients"
        [selectedClient]="selectedClient"
        (clientSelected)="onClientSelected($event)"
      >
      </app-client-list>
    </div>
  </div>
</div>

<app-expandable-panel
  [open]="selectedClient !== null"
  [title]="selectedClient?.name || 'Client Info'"
  (closed)="selectedClient = null"
>
  <ng-container *ngIf="selectedClient">
    <app-client-info [client]="selectedClient"></app-client-info>
    <div class="buttons-panel" style="margin-top: 2rem">
      <button class="btn-secondary" (click)="onOpenModal('edit')">Edit</button>
      <button class="btn-warning" (click)="onDeleteClient()">Delete</button>
    </div>
  </ng-container>
</app-expandable-panel>

<app-modal [open]="showModal" [title]="modalTitle" (closed)="onCloseModal()">
  <app-client-modal
    [selectedClient]="selectedClient"
    [modalType]="modalType"
    (submitted)="onModalSubmitted($event)"
    (cancelled)="onModalCancelled()"
  >
  </app-client-modal>
</app-modal>

<app-modal [open]="showConfirmDelete" title="Confirm Delete" (closed)="onCancelDelete()">
  <app-confirmation-dialog
    [message]="'Are you sure you want to delete ' + selectedClient?.name + '?'"
    [type]="'delete'"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()"
  >
  </app-confirmation-dialog>
</app-modal>
